import{S as nt,p as q,r as y,s as N,a as L,n as it,i as G,b as J,t as rt,f as at,c as lt,d as X,e as ut,u as P,g as D,h as ct,j as dt,k as ht,w as I,o as pt,l as ft,m as bt,q as vt,v as Y,x as Z,y as B,z as $,A as mt,B as gt,C as yt,D as kt,E as V,F as R,G as o,_ as xt,H as j,I as U,J as tt,K as et,L as z,M as A,N as Rt,O as _t,P as Ct,Q as _}from"./index-rhbYrKUQ.js";var wt=class extends nt{constructor(t,e){super(),this.options=e,this.#s=t,this.#n=null,this.#o=q(),this.bindMethods(),this.setOptions(e)}#s;#t=void 0;#f=void 0;#e=void 0;#r;#c;#o;#n;#b;#d;#h;#a;#l;#i;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),st(this.#t,this.options)?this.#u():this.updateResult(),this.#y())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return H(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return H(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#k(),this.#x(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,n=this.#t;if(this.options=this.#s.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof y(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#R(),this.#t.setOptions(this.options),e._defaulted&&!N(this.options,e)&&this.#s.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const i=this.hasListeners();i&&ot(this.#t,n,this.options,e)&&this.#u(),this.updateResult(),i&&(this.#t!==n||y(this.options.enabled,this.#t)!==y(e.enabled,this.#t)||L(this.options.staleTime,this.#t)!==L(e.staleTime,this.#t))&&this.#v();const r=this.#m();i&&(this.#t!==n||y(this.options.enabled,this.#t)!==y(e.enabled,this.#t)||r!==this.#i)&&this.#g(r)}getOptimisticResult(t){const e=this.#s.getQueryCache().build(this.#s,t),n=this.createResult(e,t);return St(this,n)&&(this.#e=n,this.#c=this.options,this.#r=this.#t.state),n}getCurrentResult(){return this.#e}trackResult(t,e){return new Proxy(t,{get:(n,i)=>(this.trackProp(i),e?.(i),i==="promise"&&!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(n,i))})}trackProp(t){this.#p.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#s.defaultQueryOptions(t),n=this.#s.getQueryCache().build(this.#s,e);return n.fetch().then(()=>this.createResult(n,e))}fetch(t){return this.#u({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#e))}#u(t){this.#R();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(it)),e}#v(){this.#k();const t=L(this.options.staleTime,this.#t);if(G||this.#e.isStale||!J(t))return;const n=rt(this.#e.dataUpdatedAt,t)+1;this.#a=setTimeout(()=>{this.#e.isStale||this.updateResult()},n)}#m(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#g(t){this.#x(),this.#i=t,!(G||y(this.options.enabled,this.#t)===!1||!J(this.#i)||this.#i===0)&&(this.#l=setInterval(()=>{(this.options.refetchIntervalInBackground||at.isFocused())&&this.#u()},this.#i))}#y(){this.#v(),this.#g(this.#m())}#k(){this.#a&&(clearTimeout(this.#a),this.#a=void 0)}#x(){this.#l&&(clearInterval(this.#l),this.#l=void 0)}createResult(t,e){const n=this.#t,i=this.options,r=this.#e,h=this.#r,p=this.#c,C=t!==n?t.state:this.#f,{state:w}=t;let d={...w},E=!1,u;if(e._optimisticResults){const f=this.hasListeners(),c=!f&&st(t,e),s=f&&ot(t,n,e,i);(c||s)&&(d={...d,...lt(w.data,t.options)}),e._optimisticResults==="isRestoring"&&(d.fetchStatus="idle")}let{error:l,errorUpdatedAt:v,status:m}=d;u=d.data;let S=!1;if(e.placeholderData!==void 0&&u===void 0&&m==="pending"){let f;r?.isPlaceholderData&&e.placeholderData===p?.placeholderData?(f=r.data,S=!0):f=typeof e.placeholderData=="function"?e.placeholderData(this.#h?.state.data,this.#h):e.placeholderData,f!==void 0&&(m="success",u=X(r?.data,f,e),E=!0)}if(e.select&&u!==void 0&&!S)if(r&&u===h?.data&&e.select===this.#b)u=this.#d;else try{this.#b=e.select,u=e.select(u),u=X(r?.data,u,e),this.#d=u,this.#n=null}catch(f){this.#n=f}this.#n&&(l=this.#n,u=this.#d,v=Date.now(),m="error");const T=d.fetchStatus==="fetching",x=m==="pending",F=m==="error",g=x&&T,Q=u!==void 0,b={status:m,fetchStatus:d.fetchStatus,isPending:x,isSuccess:m==="success",isError:F,isInitialLoading:g,isLoading:g,data:u,dataUpdatedAt:d.dataUpdatedAt,error:l,errorUpdatedAt:v,failureCount:d.fetchFailureCount,failureReason:d.fetchFailureReason,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>C.dataUpdateCount||d.errorUpdateCount>C.errorUpdateCount,isFetching:T,isRefetching:T&&!x,isLoadingError:F&&!Q,isPaused:d.fetchStatus==="paused",isPlaceholderData:E,isRefetchError:F&&Q,isStale:W(t,e),refetch:this.refetch,promise:this.#o,isEnabled:y(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const f=a=>{b.status==="error"?a.reject(b.error):b.data!==void 0&&a.resolve(b.data)},c=()=>{const a=this.#o=b.promise=q();f(a)},s=this.#o;switch(s.status){case"pending":t.queryHash===n.queryHash&&f(s);break;case"fulfilled":(b.status==="error"||b.data!==s.value)&&c();break;case"rejected":(b.status!=="error"||b.error!==s.reason)&&c();break}}return b}updateResult(){const t=this.#e,e=this.createResult(this.#t,this.options);if(this.#r=this.#t.state,this.#c=this.options,this.#r.data!==void 0&&(this.#h=this.#t),N(e,t))return;this.#e=e;const n=()=>{if(!t)return!0;const{notifyOnChangeProps:i}=this.options,r=typeof i=="function"?i():i;if(r==="all"||!r&&!this.#p.size)return!0;const h=new Set(r??this.#p);return this.options.throwOnError&&h.add("error"),Object.keys(this.#e).some(p=>{const k=p;return this.#e[k]!==t[k]&&h.has(k)})};this.#_({listeners:n()})}#R(){const t=this.#s.getQueryCache().build(this.#s,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#f=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#y()}#_(t){ut.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#e)}),this.#s.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function Tt(t,e){return y(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function st(t,e){return Tt(t,e)||t.state.data!==void 0&&H(t,e,e.refetchOnMount)}function H(t,e,n){if(y(e.enabled,t)!==!1&&L(e.staleTime,t)!=="static"){const i=typeof n=="function"?n(t):n;return i==="always"||i!==!1&&W(t,e)}return!1}function ot(t,e,n,i){return(t!==e||y(i.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&W(t,n)}function W(t,e){return y(e.enabled,t)!==!1&&t.isStaleByTime(L(e.staleTime,t))}function St(t,e){return!N(t.getCurrentResult(),e)}function Ot(t,e,n){const i=P(),r=D(()=>{const l=ct(e);typeof l.enabled=="function"&&(l.enabled=l.enabled());const v=i.defaultQueryOptions(l);return v._optimisticResults=i.isRestoring?.value?"isRestoring":"optimistic",v}),h=new t(i,r.value),p=r.value.shallow?dt(h.getCurrentResult()):ht(h.getCurrentResult());let k=()=>{};i.isRestoring&&I(i.isRestoring,l=>{l||(k(),k=h.subscribe(v=>{Z(p,v)}))},{immediate:!0});const C=()=>{h.setOptions(r.value),Z(p,h.getCurrentResult())};I(r,C),pt(()=>{k()});const w=(...l)=>(C(),p.refetch(...l)),d=()=>new Promise((l,v)=>{let m=()=>{};const S=()=>{if(r.value.enabled!==!1){h.setOptions(r.value);const T=h.getOptimisticResult(r.value);T.isStale?(m(),h.fetchOptimistic(r.value).then(l,x=>{Y(r.value.throwOnError,[x,h.getCurrentQuery()])?v(x):l(h.getCurrentResult())})):(m(),l(T))}};S(),m=I(r,S)});I(()=>p.error,l=>{if(p.isError&&!p.isFetching&&Y(r.value.throwOnError,[l,h.getCurrentQuery()]))throw l});const E=r.value.shallow?ft(p):bt(p),u=vt(E);for(const l in p)typeof p[l]=="function"&&(u[l]=p[l]);return u.suspense=d,u.refetch=w,u}function Et(t,e){return Ot(wt,t)}const Qt="/HS_vue_online_toolBox/empty%201.svg",It={VITE_APP_BASEURL:"https://todolist-api.hexschool.io"},{VITE_APP_BASEURL:M}=It,Ft=async()=>(await $.get(`${M}/todos`)).data,Ut=t=>$.post(`${M}/todos`,{content:t}),Dt=t=>$.patch(`${M}/todos/${t}/toggle`),Lt=async t=>(await $.delete(`${M}/todos/${t}`)).data,Pt=async({id:t,content:e})=>(console.log("editTodo",t,e),(await $.put(`${M}/todos/${t}`,{content:e})).data),$t=(t={})=>Et({queryKey:["todo"],queryFn:Ft,enabled:t.enabled??!1,staleTime:1e3*60*5,cacheTime:1e3*60*30}),Mt=()=>{const t=P();return B({mutationFn:Ut,onSuccess:()=>{t.invalidateQueries(["todos"])},onError:e=>{alert(e.response.data.message||"新增失敗，請重試或是洽詢客服")}})},At=()=>{const t=P();return B({mutationFn:Lt,onSuccess:e=>{alert(e.message),t.invalidateQueries(["todos"])},onError:e=>{alert(e.response.data.message||"移除失敗，請重試或是洽詢客服")}})},Bt=()=>{const t=P();return B({mutationFn:Dt,onSuccess:e=>{console.log("toggle",e),t.invalidateQueries(["todos"])},onError:e=>{alert(e.response.data.message||"完成勾選失敗，請重試或是洽詢客服")}})},Vt=()=>{const t=P();return B({mutationFn:Pt,onSuccess:e=>{console.log("edit",e),alert(e.message),t.invalidateQueries(["todos"])},onError:e=>{alert(e.response.data.message||"編輯失敗，請重試或是洽詢客服")}})},jt={class:"mx-auto px-3 pt-4"},zt={class:"w-full md:w-1/2 lg:w-1/3 mx-auto px-5"},Nt={class:"flex justify-between items-center mb-4"},Ht={class:"flex"},Wt={class:"hidden md:block"},Kt={class:"relative mb-4"},qt={key:0,class:"bg-white text-sm rounded-[10px] px-4 pb-4 md:px-6 drop-shadow"},Gt={class:"text-neutral-300 dark:text-gray-400 text-center font-bold flex flex-wrap -mx-4 -mb-[2px]"},Jt={class:"w-1/3"},Xt={class:"w-1/3"},Yt={class:"w-1/3"},Zt={class:"font-normal py-4 flex flex-col gap-y-4"},te={key:0,class:"border-b-2 border-neutral-100 -mb-[2px] pb-4 flex items-center"},ee=["onClick"],se=["onClick"],oe={class:"ms-auto flex items-center gap-x-2"},ne=["onClick"],ie=["onClick"],re={key:1,class:"flex items-center"},ae=["onUpdate:modelValue"],le={class:"ms-auto flex items-center gap-x-2"},ue=["onClick"],ce=["onClick"],de={class:"py-2"},he={key:1},fe={__name:"TodoListView",setup(t){const{mutate:e,data:n,isError:i}=mt(),{mutate:r,isSuccess:h}=gt();yt(()=>{e()});const p=Ct();I(i,()=>{i.value&&p.push("/")}),I(h,()=>{h.value&&p.push("/")});const k=D(()=>n.value?.status??!1),C=D(()=>n.value?`${n.value.nickname}`:""),{data:w,isLoading:d,isFetching:E}=$t({enabled:k}),u=D(()=>w.value?.data??[]),l=D(()=>w.value?.data.length??0);kt(()=>{d.value||E.value?console.log("正在抓取資料"):console.log(w.value?.data)});const v=V(""),{mutate:m}=Mt(),S=c=>{if(!c){alert("請輸入代辦事項");return}m(c,{onSuccess:()=>{alert("新增成功"),v.value=""}})},{mutate:T}=At(),{mutate:x}=Bt(),{mutate:F}=Vt(),g=V({}),Q=(c,s="")=>{g.value[c]?(g.value[c].isEditing=!g.value[c].isEditing,g.value[c].content=s):g.value[c]={isEditing:!0,content:s},console.log("handle",g.value[c])},K=(c,s)=>{if(!s){alert("請輸入代辦事項");return}F({id:c,content:s},{onSuccess:()=>{Q(c)}})},b=V("all"),f=c=>{console.log(c),b.value=c};return(c,s)=>(_(),R("div",jt,[o("div",zt,[o("div",Nt,[s[6]||(s[6]=o("img",{src:xt,alt:"logo",style:{width:"242.51px"}},null,-1)),o("div",Ht,[o("h2",Wt,j(C.value)+"的代辦",1),o("a",{role:"button",onClick:s[0]||(s[0]=(...a)=>U(r)&&U(r)(...a))},"登出")])]),o("div",Kt,[tt(o("input",{type:"text",id:"register_nickname",class:"bg-neutral-50 text-neutral-500 border-none rounded-[10px] focus:ring-neutral-500 focus:border-neutral-500 block w-full py-3 ps-4 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 drop-shadow",placeholder:"新增待辦事項","onUpdate:modelValue":s[1]||(s[1]=a=>v.value=a)},null,512),[[et,v.value,void 0,{trim:!0}]]),o("button",{class:"btn-square btn-neutral rounded-[10px] absolute bottom-0 right-0 -translate-[4px]",onClick:s[2]||(s[2]=a=>S(v.value))},[...s[7]||(s[7]=[o("span",{class:"material-symbols-outlined add-icon"}," add ",-1)])])]),u.value.length!==0?(_(),R("div",qt,[o("ul",Gt,[o("li",Jt,[o("a",{class:A(b.value==="all"?"block p-4 text-neutral-500 border-b-2 border-neutral-500 dark:text-blue-500 dark:border-blue-500":"block p-4 border-b-2 border-neutral-100 hover:border-gray-300"),onClick:s[3]||(s[3]=z(a=>f("all"),["prevent"]))},"全部",2)]),o("li",Xt,[o("a",{class:A(b.value==="undone"?"block p-4 text-neutral-500 border-b-2 border-neutral-500 dark:text-blue-500 dark:border-blue-500 active":"block p-4 border-b-2 border-neutral-100 hover:border-gray-300"),onClick:s[4]||(s[4]=z(a=>f("undone"),["prevent"])),"aria-current":"page"},"待完成",2)]),o("li",Yt,[o("a",{class:A(b.value==="isDone"?"block p-4 text-neutral-500 border-b-2 border-neutral-500 dark:text-blue-500 dark:border-blue-500 active":"block p-4 border-b-2 border-neutral-100 hover:border-gray-300"),onClick:s[5]||(s[5]=z(a=>f("isDone"),["prevent"]))},"已完成",2)])]),o("ul",Zt,[(_(!0),R(Rt,null,_t(u.value,a=>(_(),R("li",{key:a.id},[g.value[a.id]?.isEditing?(_(),R("div",re,[tt(o("input",{type:"text",class:"bg-neutral-100 text-neutral-500 leading-none border-b-1 border-neutral-300 rounded-[10px] focus:ring-neutral-500 focus:border-neutral-500 block w-[80%] py-2 ps-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500","onUpdate:modelValue":O=>g.value[a.id].content=O},null,8,ae),[[et,g.value[a.id].content]]),o("div",le,[o("button",{type:"button",onClick:O=>Q(a.id)},[...s[12]||(s[12]=[o("span",{class:"material-symbols-outlined close-icon text-alert-500"}," close ",-1)])],8,ue),o("button",{type:"button",onClick:O=>K(a.id,g.value[a.id].content)},[...s[13]||(s[13]=[o("span",{class:"material-symbols-outlined circle-icon text-lime-600"}," circle ",-1)])],8,ce)])])):(_(),R("div",te,[a.status?(_(),R("button",{key:0,type:"button",onClick:O=>U(x)(a.id)},[...s[8]||(s[8]=[o("span",{class:"material-symbols-outlined check-icon text-primary-500"}," check ",-1)])],8,ee)):(_(),R("button",{key:1,type:"button",onClick:O=>U(x)(a.id)},[...s[9]||(s[9]=[o("span",{class:"material-symbols-outlined checkbox-icon text-neutral-300"}," check_box_outline_blank ",-1)])],8,se)),o("p",{class:A(["ms-4",a.status?"text-neutral-300 line-through":""])},j(a.content),3),o("div",oe,[o("button",{type:"button",onClick:O=>Q(a.id,a.content)},[...s[10]||(s[10]=[o("span",{class:"material-symbols-outlined edit-icon text-neutral-500"}," edit_square ",-1)])],8,ne),o("button",{type:"button",onClick:O=>U(T)(a.id)},[...s[11]||(s[11]=[o("span",{class:"material-symbols-outlined delete-icon text-neutral-500"}," delete ",-1)])],8,ie)])]))]))),128))]),o("p",de,j(l.value)+" 個待完成項目",1)])):(_(),R("div",he,[...s[14]||(s[14]=[o("p",null,"目前尚無待辦事項",-1),o("img",{src:Qt,alt:"目前尚無待辦事項"},null,-1)])]))])]))}};export{fe as default};
